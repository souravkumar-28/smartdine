<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SmartDine | Menu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body{
         font-family:'Poppins',sans-serif;
         background:linear-gradient(135deg,#fdfbfb,#ebedee);
        }
        .navbar{
         background:linear-gradient(90deg,#ff6a00,#ee0979);
        }
        .food-card{
         border:none;
         border-radius:16px;
         box-shadow:0 8px 20px rgba(0,0,0,.08);
         overflow:hidden;
         transition:.2s;
        }
        .food-card:hover{transform:translateY(-4px);}
        .food-card img{height:140px;object-fit:cover;}
        .badge-cat{
         cursor:pointer;
         border-radius:20px;
         padding:8px 14px;
         background:#fff;
         color:#555;
         box-shadow:0 4px 10px rgba(0,0,0,.1);
         margin-right:6px;
        }
        .badge-cat:hover{background:#ff6a00;color:#fff;}
        .cart-btn{
         position:fixed;
         bottom:20px;right:20px;
         border-radius:30px;
         padding:12px 20px;
         background:linear-gradient(90deg,#ff6a00,#ee0979);
         border:none;
         box-shadow:0 6px 16px rgba(0,0,0,.2);
        }
        .modal-content{
         border-radius:16px;
        }
        .btn-primary{
         background:linear-gradient(90deg,#ff6a00,#ee0979);
         border:none;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark">
    <div class="container-fluid">
        <span class="navbar-brand fw-semibold" id="tableLabel">
 üçΩÔ∏è SmartDine
</span>

    </div>
</nav>

<div class="container my-3">

    <input type="text" id="search" class="form-control mb-3 rounded-pill" placeholder="üîç Search your favorite food...">

    <div class="mb-3">
        <span class="badge badge-cat" onclick="filterCat('All')">All</span>
        <span class="badge badge-cat" onclick="filterCat('Main')">Main</span>
        <span class="badge badge-cat" onclick="filterCat('Snacks')">Snacks</span>
        <span class="badge badge-cat" onclick="filterCat('Drinks')">Drinks</span>
    </div>

    <div class="row" id="menuList"></div>
</div>

<button class="btn btn-primary cart-btn" data-bs-toggle="modal" data-bs-target="#cartModal">
    üõí Cart (<span id="cartCount">0</span>)
</button>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">Your Cart</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="cartItems"></div>
            <div class="modal-footer border-0 d-flex justify-content-between">
                <h6>Total: ‚Çπ<span id="total">0</span></h6>
                <button class="btn btn-primary" onclick="placeOrder()">Place Order</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const params = new URLSearchParams(window.location.search);
const tableNo = params.get("table") || "1";

document.getElementById("tableLabel").innerText =
  "üçΩÔ∏è SmartDine | Table #" + tableNo;

    const API = "/api/menu";
    let menu = [];
    let cart = [];
    let currentMenu = [];

    function loadMenu(){
     fetch(API).then(r=>r.json()).then(data=>{
      // backend se aaya data: id,name,price,category
      menu = data.map(i => ({
        id: i.id,
        name: i.name,
        price: i.price,
        cat: i.category,
        img: i.imageUrl || "https://via.placeholder.com/400x300?text=Food"

      }));
      currentMenu = [...menu];
      renderMenu(menu);
     });
    }

    function renderMenu(list){
     const div=document.getElementById("menuList");
     div.innerHTML="";
     list.forEach(i=>{
     div.innerHTML+=`
     <div class="col-6 mb-3">
      <div class="card food-card">
       <img src="${i.img}" class="card-img-top">
       <div class="card-body p-3">
        <h6 class="fw-semibold">${i.name}</h6>
        <p class="mb-2 text-muted">‚Çπ${i.price}</p>
        <button class="btn btn-sm btn-primary w-100" onclick="addToCart(${i.id})">
          Add to Cart
        </button>
       </div>
      </div>
     </div>`;
     });
    }

    function addToCart(id){
     const item = menu.find(i=>i.id===id);
     const f = cart.find(c=>c.id===id);
     if(f) f.qty++;
     else cart.push({...item, qty:1});
     updateCart();
    }

    function updateCart(){
     document.getElementById("cartCount").innerText =
       cart.reduce((a,b)=>a+b.qty,0);

     let html="", total=0;
     cart.forEach(c=>{
      total += c.qty*c.price;
      html += `<div class="d-flex justify-content-between mb-1">
       <span>${c.name} x ${c.qty}</span>
       <span>‚Çπ${c.qty*c.price}</span>
      </div>`;
     });
     document.getElementById("cartItems").innerHTML =
       html || "<p class='text-muted'>Cart is empty</p>";
     document.getElementById("total").innerText = total;
    }

    document.getElementById("search").addEventListener("input",e=>{
     const v=e.target.value.toLowerCase();
     renderMenu(currentMenu.filter(i=>i.name.toLowerCase().includes(v)));
    });

    function filterCat(cat){
 if(cat==="All"){
  currentMenu = menu;
 } else {
  currentMenu = menu.filter(i =>
    i.cat.toLowerCase() === cat.toLowerCase()
  );
 }
 renderMenu(currentMenu);
}


    // initial load from backend
    loadMenu();

    function incQty(i){
 cart[i].qty++;
 updateCart();
}

function decQty(i){
 cart[i].qty--;
 if(cart[i].qty<=0) cart.splice(i,1);
 updateCart();
}

    function updateCart(){
 document.getElementById("cartCount").innerText =
   cart.reduce((a,b)=>a+b.qty,0);

 let html="", total=0;
 cart.forEach((c,idx)=>{
  total += c.qty*c.price;
  html += `<div class="d-flex justify-content-between align-items-center mb-2">
   <span>${c.name}</span>
   <div>
    <button class="btn btn-sm btn-secondary" onclick="decQty(${idx})">-</button>
    <span class="mx-2">${c.qty}</span>
    <button class="btn btn-sm btn-secondary" onclick="incQty(${idx})">+</button>
    <span class="ms-2">‚Çπ${c.qty*c.price}</span>
   </div>
  </div>`;
 });
 document.getElementById("cartItems").innerHTML =
   html || "<p class='text-muted'>Cart is empty</p>";
 document.getElementById("total").innerText = total;
}
function placeOrder(){
 if(cart.length===0){
  alert("Cart is empty!");
  return;
 }

 const order = {
  tableNo: tableNo,
  total: cart.reduce((a,b)=>a + b.qty*b.price, 0),
  items: cart.map(c => ({
    name: c.name,
    price: c.price,
    qty: c.qty
  }))
 };

 fetch("/api/orders",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body: JSON.stringify(order)
 }).then(r=>r.json()).then(o=>{
  alert("Order placed! Order ID: " + o.id);
  cart=[];
  updateCart();
 });
}

</script>

</body>
</html>
